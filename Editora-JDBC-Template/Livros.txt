-- MySQL Workbench Synchronization
-- Generated: 2018-04-19 22:17
-- Model: New Model
-- Version: 1.0
-- Project: Name of the project
-- Author: leand

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

ALTER TABLE `editora-db`.`AUTORES` 
DROP FOREIGN KEY `fk_AUTORES_editoras`;

ALTER TABLE `editora-db`.`AUTORES` 
DROP COLUMN `ID_EDITORA`,
ADD COLUMN `ID_EDITORA` INT(11) NOT NULL AFTER `EMAIL`,
DROP PRIMARY KEY,
ADD PRIMARY KEY (`ID_AUTOR`, `ID_EDITORA`),
ADD INDEX `fk_AUTORES_editoras_idx` (`ID_EDITORA` ASC),
DROP INDEX `fk_AUTORES_editoras_idx` ;

ALTER TABLE `editora-db`.`LIVROS` 
DROP COLUMN `AUTOR`,
CHANGE COLUMN `ID_LIVRO` `ID_LIVRO` INT(11) NOT NULL AUTO_INCREMENT ,
ADD COLUMN `EDICAO` INT(11) NOT NULL AFTER `TITULO`,
ADD COLUMN `PAGINAS` INT(11) NOT NULL AFTER `EDICAO`,
ADD UNIQUE INDEX `TITULO_EDICAO` (`TITULO` ASC, `EDICAO` ASC);

CREATE TABLE IF NOT EXISTS `editora-db`.`LIVROS_AUTORES` (
  `ID_LIVRO_AUTOR` INT(11) NOT NULL AUTO_INCREMENT,
  `ID_LIVRO` INT(11) NOT NULL,
  `ID_AUTOR` INT(11) NOT NULL,
  PRIMARY KEY (`ID_LIVRO_AUTOR`),
  INDEX `fk_Livros_has_AUTORES_AUTORES1_idx` (`ID_AUTOR` ASC, `ID_LIVRO_AUTOR` ASC),
  INDEX `fk_Livros_has_AUTORES_Livros1_idx` (`ID_LIVRO` ASC),
  UNIQUE INDEX `ID_LIVRO_ID_AUTOR` (`ID_LIVRO` ASC, `ID_AUTOR` ASC),
  CONSTRAINT `fk_Livros_has_AUTORES_Livros1`
    FOREIGN KEY (`ID_LIVRO`)
    REFERENCES `editora-db`.`LIVROS` (`ID_LIVRO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Livros_has_AUTORES_AUTORES1`
    FOREIGN KEY (`ID_AUTOR` , `ID_LIVRO_AUTOR`)
    REFERENCES `editora-db`.`AUTORES` (`ID_AUTOR` , `ID_EDITORA`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

ALTER TABLE `editora-db`.`AUTORES` 
ADD CONSTRAINT `fk_AUTORES_editoras`
  FOREIGN KEY (`ID_EDITORA`)
  REFERENCES `editora-db`.`editoras` (`ID_EDITORA`)
  ON DELETE CASCADE
  ON UPDATE NO ACTION;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
